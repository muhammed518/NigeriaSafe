{% extends "base/base.html" %}
{% load static %}

{% block title %}SOS Monitor ‚Äî NigeriaSafe{% endblock %}

{% block content %}
<div class="monitor-container">
  <div class="monitor-header">
    <h1>SOS Alerts Monitor</h1>
    <div class="monitor-controls">
      <a href="." class="monitor-btn monitor-btn-primary">
        <i class="fas fa-sync-alt"></i> Refresh
      </a>
    </div>
  </div>

  <div class="alerts-grid">
    {% for a in alerts %}
    <div class="alert-card">
      <div class="alert-card-header">
        <span class="alert-status {% if a.status == 'pending' %}status-critical{% endif %}">
          {{ a.get_status_display }}
        </span>
        <small style="color: #999; font-weight: 600;">{{ a.created_at|timesince }} ago</small>
      </div>
      
      <div class="alert-card-body">
        <h3 style="font-size: 18px; margin-bottom: 15px; color: #333;">
          {% if a.patient %}{{ a.patient.full_name }} <span style="font-size: 0.85em; color: #666;">(MRN: {{ a.patient.medical_record_numberer }})</span>{% else %}Anonymous User{% endif %}
        </h3>
        
        <div class="alert-location">
          <i class="fas fa-map-marker-alt"></i>
          <div style="flex: 1;">
            {% if a.location_text %}
            <div style="color: #333; text-decoration: none; font-weight: 500; font-size: 14px;">
              üìç {{ a.location_text }}
            </div>
            {% endif %}
            <a href="https://www.google.com/maps/search/?api=1&query={{ a.latitude }},{{ a.longitude }}" target="_blank" style="color: #333; text-decoration: none; font-weight: 500; font-size: 14px;">
              View Location on Map
            </a>
            <div style="font-size: 12px; color: #888; margin-top: 2px;">
              {{ a.latitude|floatformat:4 }}, {{ a.longitude|floatformat:4 }}
            </div>
          </div>
        </div>

        {% if a.message %}
        <div style="background: #fff; border: 1px solid #eee; padding: 12px; border-radius: 8px; font-size: 14px; color: #555;">
          <strong>Note:</strong> {{ a.message }}
        </div>
        {% endif %}
      </div>
    </div>
    {% empty %}
    <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #888;">
      <i class="fas fa-check-circle" style="font-size: 48px; color: #eee; margin-bottom: 20px;"></i>
      <p>No active alerts found.</p>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
